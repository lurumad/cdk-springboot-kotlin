name: Deployment workflow

env:
  AWS_REGION: us-east-1
  ENVIRONMENT: dev

on:
  push:
    branches:
      - main

jobs:
  # aws-cdk:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3
  #     - name: Configure aws credentials
  #       uses: aws-actions/configure-aws-credentials@master
  #       with:
  #         aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY }}
  #         aws-secret-access-key: ${{ secrets.AWS_SECRET_KEY }}
  #         aws-region: ${{ env.AWS_REGION }}
  #     - uses: actions/setup-node@v2
  #       with:
  #         node-version: "16"
  #     - name: CDK Build
  #       run:
  #         cd infra && npm ci && npm run build
  #     - name: CDK Deploy
  #       run:
  #         cd infra && REGION=${{ env.AWS_REGION }} ACCOUNT_ID=${{ secrets.AWS_ACCOUNT_ID }} ENVIRONMENT=${{ env.ENVIRONMENT }} npx cdk deploy --all --require-approval never --outputs-file ./cdk-outputs.json

  gradle:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Setup Gradle
        uses: gradle/gradle-build-action@v2
        with:
          gradle-version: 7.6
      - name: Run build with Gradle Wrapper
        run: cd app/todos && ./gradlew build

